"use strict";(self.webpackChunkukraine_sample=self.webpackChunkukraine_sample||[]).push([[8675,5840],{45840:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>u});var a=i(85504),n=i(16770);class r{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let a=this._inFlightResourceMap.get(e);return a?a.then((e=>({width:e.width,height:e.height}))):(a=(0,n.M5)(e,t),this._inFlightResourceMap.set(e,a),a.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,a.Al)(e)}}var s=i(16355),l=i(67855),h=i(48988),o=i(97763);const c=96/72;class u{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new r}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,a,n,r,s,c,u){if(!e)return null;const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:d}=y;r||(r=(0,o.n5)(d));const m=await h.$.resolveSymbolOverrides(y,t,this._spatialReference,n,r,s,c),w=this._cimResourceManager,p=[];l.wp.fetchResources(m,w,p),l.wp.fetchFonts(m,w,p),p.length>0&&await Promise.all(p);const{width:f,height:M}=i,b=g(r,f,M,a),v=l.wp.getEnvelope(m,b,w);if(!v)return null;let R=1,C=0,_=0;switch(d.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;v.width>f&&(e=f/v.width);let t=1;v.height>M&&(t=M/v.height),"preview"===a&&(v.width<f&&(e=f/v.width),v.height<M&&(t=M/v.height)),R=Math.min(e,t),C=v.x+v.width/2,_=v.y+v.height/2}break;case"CIMLineSymbol":{(u||v.height>M)&&(R=M/v.height),_=v.y+v.height/2;const e=v.x*R+f/2,t=(v.x+v.width)*R+f/2,{paths:i}=b;i[0][0][0]-=e/R,i[0][2][0]-=(t-f)/R}break;case"CIMPolygonSymbol":{C=v.x+v.width/2,_=v.y+v.height/2;const e=v.x*R+f/2,t=(v.x+v.width)*R+f/2,i=v.y*R+M/2,a=(v.y+v.height)*R+M/2,{rings:n}=b;e<0&&(n[0][0][0]-=e,n[0][3][0]-=e,n[0][4][0]-=e),i<0&&(n[0][0][1]+=i,n[0][1][1]+=i,n[0][4][1]+=i),t>f&&(n[0][1][0]-=t-f,n[0][2][0]-=t-f),a>M&&(n[0][2][1]+=a-M,n[0][3][1]+=a-M)}}const S={type:"cim",data:{type:"CIMSymbolReference",symbol:m}};return this.rasterize(S,f,M,C,_,R,r,1,b)}rasterize(e,t,i,a,n,r,l){let h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:d}=y,m=this._canvas,w=(window.devicePixelRatio||1)*c;m.width=t*w,m.height=i*w,l||(l=(0,o.n5)(d)),u||(u=g(l,t,i,"legend")),m.width+=2*h,m.height+=2*h;const p=m.getContext("2d",{willReadFrequently:!0}),f=s.IT.createIdentity();return f.translate(-a,-n),f.scale(r*w,-r*w),f.translate(t*w/2+h,i*w/2+h),p.clearRect(0,0,m.width,m.height),new s.Rj(p,this._cimResourceManager,f,!0).drawSymbol(d,u),p.getImageData(0,0,m.width,m.height)}}function g(e,t,i,a){const n=-t/2+1,r=t/2-1,s=i/2-1,l=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[r,0]]]};default:return"legend"===a?{rings:[[[n,s],[r,0],[r,l],[n,l],[n,s]]]}:{rings:[[[n,s],[r,s],[r,l],[n,l],[n,s]]]}}}},28675:(e,t,i)=>{i.d(t,{previewCIMSymbol:()=>w});var a=i(76931),n=i(67855),r=i(45840),s=i(48988),l=i(97763),h=i(65709),o=i(26291);const c=new r.CIMSymbolRasterizer(null),u=(0,a.PN)(h.CB.size),g=(0,a.PN)(h.CB.maxSize),y=(0,a.PN)(h.CB.lineWidth),d=1;async function m(e,t,i){const a=t?.size;let r=null!=a&&"object"==typeof a&&"width"in a?a.width:a,l=null!=a&&"object"==typeof a&&"height"in a?a.height:a;if(null==r||null==l)if("esriGeometryPolygon"===i)r=u,l=u;else{const a=await async function(e,t,i){const{feature:a,fieldMap:r,viewParams:l}=t.cimOptions||t,h=await s.$.resolveSymbolOverrides(e.data,a,null,r,i,null,l);if(!h)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:h},e.data.primitiveOverrides=void 0;const o=[];return n.wp.fetchResources(h,c.resourceManager,o),n.wp.fetchFonts(h,c.resourceManager,o),o.length>0&&await Promise.all(o),n.wp.getEnvelope(h,null,c.resourceManager)}(e,t,i);a&&(r=a.width,l=a.height),"esriGeometryPolyline"===i&&(r=y),r=null!=r&&isFinite(r)?Math.min(r,g):u,l=null!=l&&isFinite(l)?Math.max(Math.min(l,g),d):u}return"legend"===t.style&&"esriGeometryPolyline"===i&&(r=y),{width:r,height:l}}async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{node:i,opacity:n,symbolConfig:r}=t,s=null!=r&&"object"==typeof r&&"isSquareFill"in r&&r.isSquareFill,h=t.cimOptions||t,u=h.geometryType||(0,l.n5)(e?.data?.symbol),g=await m(e,t,u),{feature:y,fieldMap:d}=h,w=s||"esriGeometryPolygon"!==u?"preview":"legend",p=await c.rasterizeCIMSymbolAsync(e,y,g,w,d,u,null,h.viewParams,h.allowScalingUp);if(!p)return null;const{width:f,height:M}=p,b=document.createElement("canvas");b.width=f,b.height=M,b.getContext("2d").putImageData(p,0,0);const v=(0,a.Lz)(g.width),R=(0,a.Lz)(g.height),C=new Image(v,R);C.src=b.toDataURL(),C.ariaLabel=t.ariaLabel??null,C.alt=t.ariaLabel??"",null!=n&&(C.style.opacity=`${n}`);let _=C;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:v,height:R,src:C.src},fill:null,stroke:null,offset:[0,0]};_=(0,o.fz)([[e]],[v,R],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return i&&_&&i.appendChild(_),_}}}]);
//# sourceMappingURL=8675.e602c9de.chunk.js.map